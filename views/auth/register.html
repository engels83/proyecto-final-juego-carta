<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <title>Document</title>
  </head>
  <body>
    <div class="container">
      <form>
        <div class="form-group">
          <label for="exampleInputEmail1">Nickname</label>
          <input
            type="text"
            class="form-control"
            id="nickname"
            aria-describedby="small-nickname"
            placeholder="Ingrese su nickname"
          />
          <small id="small-nickname" class="form-text text-muted"></small>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Email</label>
          <input
            type="email"
            class="form-control"
            id="email"
            aria-describedby="small-email"
            placeholder="Enter email"
          />
          <small id="small-email" class="form-text text-muted"></small>
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">Password</label>
          <input
            type="password"
            class="form-control"
            id="password"
            placeholder="Password"
          />
        </div>

        <div class="form-group">
          <label for="exampleInputPassword1">Confirme Password</label>
          <input
            type="password"
            class="form-control"
            id="password-confirm"
            placeholder="Password"
          />
        </div>

        <button type="button" class="btn btn-primary" id="submit">
          Crear Usuario
        </button>
      </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>

    <script>
      $(document).ready(() => {
        function ValidateEmail(mail) {
          if (/^\w+([\.-]?\w+)@\w+([\.-]?\w+)(\.\w{2,3})+$/.test(mail)) {
            return true;
          }

          return false;
        }

        $("#submit").click(() => {
          //Validaciones
          let nickname = $("#nickname").val();
          let email = $("#email").val();
          let password = $("#password").val();
          let passwordConfirm = $("#password-confirm").val();

          $("#small-nickname").text("");
          $("#small-email").text("");
          if (nickname == "" || nickname.length < 3) {
            $("#small-nickname").text("Nickname incompleto o no valido");
            console.log("nickname incompleto");
          } else if (!ValidateEmail(email)) {
            $("#small-email").text("Email incompleto o no valido");
          } else if (password != passwordConfirm) {
            alert("password no coinciden");
          } else {
            let post = {
              userName: nickname,
              email: email,
              password: password
            };

            //POST
            $.ajax({
              method: "POST",
              url: "/api/v1/security/registro",
              data: post,
              dataType: "JSON",
              success: data => {
                location.href = "/login";
              },
              error: error => {
                console.log(error);
              }
            });
          }
        });
      });
    </script>
  </body>
</html>
